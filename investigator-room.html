<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Investigator Room - Detective AI</title>
  <style>
    body {
      background: #121212;
      color: #eee;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0; padding: 0;
      min-height: 100vh;
      display: flex; justify-content: center; align-items: flex-start;
    }

    #login-container, #room-content {
      background: #1e1e1e;
      padding: 25px 30px;
      border-radius: 12px;
      box-shadow: 0 0 20px #3f51b5;
      max-width: 960px;
      width: 95%;
      margin: 50px 0;
    }

    #room-content { display: none; }

    h1 {
      color: #3f51b5;
      margin-bottom: 25px;
    }

    button {
      background: #3f51b5;
      border: none;
      border-radius: 8px;
      padding: 12px 25px;
      font-size: 1rem;
      color: #fff;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 15px;
    }

    button:hover {
      background: #5c6bc0;
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
    }

    input[type=password], textarea {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      background: #292929;
      border: none;
      border-radius: 8px;
      color: #eee;
      font-size: 1rem;
      box-sizing: border-box;
      resize: vertical;
    }

    textarea {
      min-height: 80px;
    }

    .report {
      background: #292929;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 30px;
      max-height: 500px;
      overflow-y: auto;
    }

    .report h3 {
      margin-top: 0;
      color: #81a6ff;
    }

    .status {
      margin-top: 10px;
      font-weight: 600;
    }

    .saved-notes {
      margin-top: 15px;
      background: #222;
      border-radius: 8px;
      padding: 10px;
      max-height: 140px;
      overflow-y: auto;
      font-size: 0.9rem;
    }

    .note-item {
      border-bottom: 1px solid #444;
      padding: 6px 0;
    }

    .note-item:last-child {
      border-bottom: none;
    }

    .data-block {
      border: 1px solid #444;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      background: #1f1f1f;
      max-height: 120px;
      overflow-y: auto;
    }

    .flex-row {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }

    .flex-col {
      flex: 1 1 300px;
      min-width: 280px;
    }
  </style>
</head>
<body>

  <!-- Login Form -->
  <div id="login-container">
    <h2>üîê Investigator Access</h2>
    <p>Enter password to access Investigator Room.</p>
    <form onsubmit="checkPassword(event)">
      <input type="password" id="pwd-input" placeholder="Password" required />
      <button type="submit">Enter</button>
    </form>
  </div>

  <!-- Main Investigator Room -->
  <div id="room-content">
    <h1>üïµÔ∏è Investigator Room</h1>
    <div id="reports-container">
      <!-- Reports will be dynamically inserted here -->
    </div>
  </div>

  <script>
    const correctPassword = 'investigator2025'; // You can change this

    function checkPassword(event) {
      event.preventDefault();
      const val = document.getElementById('pwd-input').value;
      if (val === correctPassword) {
        document.getElementById('login-container').style.display = 'none';
        document.getElementById('room-content').style.display = 'block';
        loadReports();
      } else {
        alert('Incorrect password! Access denied.');
      }
    }

    function loadReports() {
      const container = document.getElementById('reports-container');
      let reports = JSON.parse(localStorage.getItem('clientReports') || '[]');
      if (reports.length === 0) {
        container.innerHTML = '<p>No client reports available.</p>';
        return;
      }

      let psychData = JSON.parse(localStorage.getItem('psychologistData') || '{}');
      let analystData = JSON.parse(localStorage.getItem('analystData') || '{}');
      let investigatorData = JSON.parse(localStorage.getItem('investigatorData') || '{}');

      container.innerHTML = '';

      reports.forEach((report, idx) => {
        let psych = psychData[idx] || {};
        let analyst = analystData[idx] || {};
        let investigator = investigatorData[idx] || { detectiveNotes: '', assignedTasks: '', savedNotes: [] };

        const nameEncoded = encodeURIComponent(report.name);
        const behaviorEncoded = encodeURIComponent(report.behavior);
        const whenEncoded = encodeURIComponent(report.when);

        const googleSearch = `https://www.google.com/search?q=${nameEncoded}`;
        const facebookSearch = `https://www.facebook.com/search/top?q=${nameEncoded}`;
        const twitterSearch = `https://twitter.com/search?q=${nameEncoded}`;
        const scholarSearch = `https://scholar.google.com/scholar?q=${behaviorEncoded}`;

        function getSentiment(text) {
          const positive = ['good', 'happy', 'safe', 'love', 'support'];
          const negative = ['bad', 'sad', 'fear', 'hate', 'bully', 'danger', 'hurt'];
          const txt = text.toLowerCase();
          let score = 0;
          positive.forEach(word => { if (txt.includes(word)) score++; });
          negative.forEach(word => { if (txt.includes(word)) score--; });
          if (score > 0) return 'üòä Positive';
          if (score < 0) return 'üòü Negative';
          return 'üòê Neutral';
        }

        const sentimentResult = getSentiment(report.message || '');

        const div = document.createElement('div');
        div.className = 'report';

        div.innerHTML = `
          <h3>Report #${idx + 1} - ${escapeHtml(report.name)}</h3>
          <div class="flex-row">
            <div class="flex-col">
              <b>Client Info</b>
              <div class="data-block">
                Age: ${escapeHtml(report.age)}<br>
                Gender: ${escapeHtml(report.gender)}<br>
                When: ${escapeHtml(report.when)}<br>
                Behavior: ${escapeHtml(report.behavior)}<br>
                Message: ${escapeHtml(report.message)}<br>
                <b>Message Sentiment:</b> ${sentimentResult}
              </div>
              <div style="margin-top:10px;">
                <b>Quick Searches:</b><br>
                <button onclick="window.open('${googleSearch}','_blank')">Google</button>
                <button onclick="window.open('${facebookSearch}','_blank')">Facebook</button>
                <button onclick="window.open('${twitterSearch}','_blank')">Twitter</button>
                <button onclick="window.open('${scholarSearch}','_blank')">Scholar</button>
              </div>
            </div>

            <div class="flex-col">
              <b>Psychologist Observations</b>
              <div class="data-block">${escapeHtml(psych.observations || 'No data')}</div>
              <b>Behavior Details</b>
              <div class="data-block">${escapeHtml(psych.behaviorDetails || 'No data')}</div>
              <b>Psychological Notes</b>
              <div class="data-block">${escapeHtml(psych.notes || 'No data')}</div>
            </div>

            <div class="flex-col">
              <b>Analyst Observations</b>
              <div class="data-block">${escapeHtml(analyst.observations || 'No data')}</div>
              <b>Analytical Notes</b>
              <div class="data-block">${escapeHtml(analyst.notes || 'No data')}</div>
            </div>
          </div>

          <label>Detective Notes:</label>
          <textarea id="detective-notes-${idx}" placeholder="Add your detective notes...">${investigator.detectiveNotes || ''}</textarea>

          <label>Assign Tasks to Team:</label>
          <textarea id="assigned-tasks-${idx}" placeholder="Write tasks for psychologist or analyst...">${investigator.assignedTasks || ''}</textarea>

          <button onclick="saveData(${idx})">Save Investigator Data</button>
          <div class="status" id="status-${idx}"></div>

          <div class="saved-notes" id="saved-notes-${idx}">
            ${renderSavedNotes(investigator.savedNotes || [])}
          </div>
        `;

        container.appendChild(div);
      });
    }

    function saveData(idx) {
      const detectiveNotes = document.getElementById(`detective-notes-${idx}`).value.trim();
      const assignedTasks = document.getElementById(`assigned-tasks-${idx}`).value.trim();
      const status = document.getElementById(`status-${idx}`);

      let investigatorData = JSON.parse(localStorage.getItem('investigatorData') || '{}');

      if (!investigatorData[idx]) {
        investigatorData[idx] = { detectiveNotes: '', assignedTasks: '', savedNotes: [] };
      }

      investigatorData[idx].detectiveNotes = detectiveNotes;
      investigatorData[idx].assignedTasks = assignedTasks;

      const now = new Date().toLocaleString();
      investigatorData[idx].savedNotes = investigatorData[idx].savedNotes || [];
      investigatorData[idx].savedNotes.push(`[${now}] Investigator data saved.`);

      localStorage.setItem('investigatorData', JSON.stringify(investigatorData));

      status.style.color = '#4caf50';
      status.textContent = 'Investigator data saved successfully.';
      renderSavedNotesUI(idx, investigatorData[idx].savedNotes);
    }

    function renderSavedNotes(notesArr) {
      if (notesArr.length === 0) {
        return '<em>No saved notes yet.</em>';
      }
      return notesArr.map(n => `<div class="note-item">${escapeHtml(n)}</div>`).join('');
    }

    function renderSavedNotesUI(idx, notesArr) {
      const container = document.getElementById(`saved-notes-${idx}`);
      container.innerHTML = renderSavedNotes(notesArr);
    }

    function escapeHtml(text) {
      if (!text) return '';
      return text.replace(/[&<>"']/g, function(m) {
        return {'&':'&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;', "'":'&#39;'}[m];
      });
    }
  </script>

</body>
</html>
